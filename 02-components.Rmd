# R Markdown components

Generally, R Markdown files consist of two parts.
The first is the YAML front matter that contains the documents meta information and rendering options.
It is located at the top of the R Markdown document.
The second part is the main body that contains R code chunks and prose in Markdown format.

## YAML front matter

[YAML](https://en.wikipedia.org/wiki/YAML) is a human-readable and easy to write language to define data structures.
You don't need to familiarize yourself intimately with YAML to use R Markdown or `papaja` and I suggest you try to just use it.
The following is the default YAML front matter.

```{r yaml_front_matter, results = 'asis', echo = FALSE, eval = FALSE}
yaml <- readLines(
  system.file(
    "rmarkdown", "templates", "apa6", "skeleton"
    , "skeleton.Rmd"
    , package = "papaja"
  )
)

cat(
  paste(
    "    "
    , c(
      "" # "```{yaml yaml_front_matter, eval = FALSE}"
      , yaml[which(yaml == "---")[1]:which(yaml == "---")[2]]
      # , "```"
    )
    , collapse = "\n"
  )
)
```

```{yaml yaml_front_matter_, eval = FALSE}
---
title             : "The title"
shorttitle        : "Title"

author: 
  - name          : "First Author"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
  - name          : "Ernst-August Doelle"
    affiliation   : "1,2"

affiliation:
  - id            : "1"
    institution   : "Wilhelm-Wundt-University"
  - id            : "2"
    institution   : "Konstanz Business School"

author_note: >
  Complete departmental affiliations for each author (note the indentation, if you start a new paragraph).

  Enter author note here.

abstract: >
  Enter abstract here (note the indentation, if you start a new paragraph).
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

figsintext        : no
figurelist        : no
tablelist         : no
footnotelist      : no
lineno            : yes

lang              : "english"
class             : "man"
output            : papaja::apa6_pdf
---
```

### Manuscript meta data

The `title` is the full name of the manuscript that is printed on the title page and at the beginning of the introduction.
The `shorttitle` is a shortened variant of the title and will be printed in the running head on every page.

`author` is a structured list.
Each author's information is given in a separate element that is indented and starts with `-`.
A full `name` and an `affiliation` symbol need to be provided for every author.
The symbol is later printed as superscript following the author's name and can be a combination of multiple symbols if the author has multiple affiliations (e.g., Ernst-August Doelle^1,2^).
Exactly one author has to be declared as corresponding author by adding `corresponding: yes` and the fields `address` and `email` to the author's information.
The latter two fields are used to automatically generate the last sentence of the author note giving the contact information of the corresponding author---as required by the APA guidelines---and is optional, that is, it will not be printed, for all other authors.

`affiliation` is another structured list containing the institutions' information; again each new element is indented and starts with `-`.
The `id` is printed as superscript in front of the `institution` name below the author names on the title page (e.g., ^2^ Konstanz Business School).

`author_note` and `abstract` contain the text for the corresponding sections of the manuscript.
The `>` indicates that all following indented lines are part of this field.
Finally, `keywords` and `wordcount`[^word_count] are printed below the abstract.

[^word_count]:
We hope to automate the word count [in the future][Future directions].
For now, we recommend using the [wordcountaddin](https://github.com/benmarwick/wordcountaddin) package [@R-wordcountaddin].

The `bibliography` field, contains a list of one or more Bib(La)TeX files containing the references cited in the manuscript.
Additional files can be added by appending them to the list separated by commas, e.g. `bibliography: ["my_bib1.bib", "my_bib2.bib"]`.
By default, `papaja` assumes that you will cite R and all R packages used for the analysis contained in `r-references.bib`.
See [Citations] for instructions on how to automate this.

An additional field, that is not included in the default YAML front matter is `note`.
The contents of this field is printed on title page below the author information and can be used to add remarks, such as "Preprint submitted on June, 29th, 2016".


### Rendering options

The first set of rendering options breaks with the [guiding principal][Guiding principles] *is convertible*; they have no effect on Word documents.
I decided to implement these nonetheless because they are required by some journals and can be used for submissions where (initially) PDF documents are accepted.
`figsintext` indicates whether figures and tables should included at the end of the document---as required by APA guidelines---or rendered in the body of the document.
If `figurelist`, `tablelist`, or `footnotelist` are set to `yes` a list of figure captions, table captions, or footnotes is given following the reference section.
`lineno` indicates whether lines should be continuously numbered through out the manuscript.

The language of the manuscript is given in `lang` and affects automatically generated text, such as "Author note" on the title page or "Figure 1." in figure captions.
Currently, `english` and `german` are supported.
`class` defines the layout style of the manuscript.
Setting `class` to `man` produces the default APA manuscript style, `doc` produces a more typical document (single-spaced, single-column).
The latter option is currently not available for Word documents.

The `output` field determines the type of document that is created, either `papaja::apa6_pdf` or `papaja::apa6_word`.
Additional arguments can be passed to these functions, e.g. to delete the TeX source file at the end of the rendering process.
See `?apa6_pdf` for details.

```{yaml eval = FALSE}
output: 
  papaja::apa6_pdf:
    keep_tex: FALSE
```

Any additional rendering options supported by `rmarkdown::pdf_document()` or `rmarkdown::word_document()` can be added to the YAML front matter.
If you, for example, need a different citation style, you can set `csl` to the path of a [CSL](http://citationstyles.org/) style definition file.


## Body

The body of R Markdown documents consists of prose written in Markdown interspersed with R code.

### Markdown

A general principle in typesetting---be it on (digital) paper or the web---is to separate content and style.
Separation is commonly achieved through the use of a markup language, which is a system of document annotations.
These annotations declare portions of text as, for example, title, section headings, or list items but crucially, they are agnostic to what this means visually (e.g., <bold>text</bold> instead of **text**).
Separation of content and tyle is useful because it enables swift changes to an entire documents' style or structure.
Word implements this strategy in their so-called *styles*, which are collections of formatting instructions that can be assigned to parts of the text.

`papaja` uses [Markdown](http://en.wikipedia.org/wiki/Markdown) [@???] to separate content and style.
Markdown is intended to be an easy-to-read and -write formatting syntax.
The key design goal was to create a syntax that is readable as-is.
The following is an excerpt from the APA example manuscript written in Markdown.

```{markdown markdown_example}
# Methods
## Participants
Younger adults (14 women, 10 men, $M_{age} = 19.5$ years, age range: 18–22 years) were recruited with flyers posted on the Boston College campus. <!-- Add flyer to appendix! -->
Older adults (15 women, nine men, $M_{age} = 76.1$ years, age range: 68–84 years) were recruited through the Harvard Cooperative on Aging (see Table 1, for demographics and test scores).[^p]

[^p]: Analyses of covariance were conducted with these covariates, with no resulting influences of these variables on the pattern or magnitude of the results.
```

Without knowing anything about Markdown, it should be easy to guess what the annotations mean.
`#` declare hierarchical section headings, `<!--` and `-->` envelope comments, and `[^p]` adds a reference to a footnote.

<!-- Add examples of most common Markdown syntax -->

A comprehensive overview of the supported Markdown syntax is provided by [RStudio's R Markdown documentation](http://rmarkdown.rstudio.com/authoring_pandoc_markdown.html).

The only thing that may be unexpected are the equations enveloped by `$`.
Equations are written in the powerful [mathematics syntax](https://en.wikibooks.org/wiki/LaTeX/Mathematics) used in LaTeX (see also [Equations]).
Although LaTeX is widely used to write entire manuscripts (not just equations), it is not very popular in the field of Psychology.
I suspect that the neglect is largely due to its complexity and long learning curve, which I find rather deterring myself.
Both seem to outweigh the advantages of the system when it comes to handling citations and cross-references or typesetting large documents, complex tables, and equations.
Markdown (and pandoc) provide a simple interface to harness the power of LaTeX without having to write or know much about LaTeX (see [Document compilation]).

### R code

There are two ways to include R code in R Markdown documents.
The primary method is to insert code chunks.

    `r ''````{r code_chunk, echo = FALSE}
    age_mean <- mean(demographics$age)
    ```

These chunks are enclosed in ` `r ''```` ` and the first line defines the programming language (`r`, other lanugages, such as `python` are possible), the chunk label or name (`code_chunk`), and additional options (e.g., `echo = FALSE`).
By default, `papaja` sets the chunk options `echo = FALSE` and `message = FALSE` globally for all chunks.
`echo = FALSE` hides the code in each code chunk and `message = FALSE` hides any messages generated by the R code so that they are not included in the manuscript.
Both settings can be overwritten by the user.
See the [knitr documentation](http://yihui.name/knitr/options/) for further chunk options.

R code can also be included in a line of regular text by inserting `` ``r ''`r ...` ``, where `...` is the desired code to be executed.
Including R code inline is a conveinient way of including the contents of variables as part of the text.
For example, imagine you compute the mean and standard deviation of participants' age and store them variables named `age_mean` and `age_sd`.
You can report these numbers by printing the variables in inline R code.

```{r inline_r_code, eval = FALSE, }
Participants mean age was `r age_mean` years ($SD = `r age_sd`$).
```

In R Markdown documents, as in any other R script, code is executed serially (i.e., from top to bottom).
Thus, any variables that are called in code chunks or inline R code must be defined above.


## Splitting an R Markdown document

Some authors may prefer to split long manuscripts into multiple component files for better clarity.
There are two basic strategies to split R Markdown documents that can be combined or used in isolation: sourcing R scripts and splitting the R Markdown document.
If the R Markdown document contains a lot of code, it may be helpful to disincorporate parts of the code, such as reading, merging, restructuring, and relabeling data files.
The R scripts can then be executed at the respective section of the document using `source()`.

Some authors may prefer to split long manuscripts into a master or parent document and multiple children.
The master document, for example, consists of the YAML front matter and includes the children, which are themselves R Markdown documents without a YAML front matter.
To include a child document, insert an empty chunk and provide the path to the R Markdown document in the chunk option `child`.
    
    `r ''````{r child = "introduction.Rmd"}
    ```
    `r ''````{r child = "methods.Rmd"}
    ```
    `r ''````{r child = "results.Rmd"}
    ```
    `r ''````{r child = "discussion.Rmd"}
    ```

